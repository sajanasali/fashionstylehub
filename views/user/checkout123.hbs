<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>
    <style>
      body {
        color: #69707a;
      }

      .img-account-profile {
        height: 10rem;
      }

      .rounded-circle {
        border-radius: 50% !important;
      }

      .card {
        box-shadow: 0 0.15rem 1.75rem 0 rgb(33 40 50 / 15%);
      }

      .card .card-header {
        font-weight: 500;
      }

      .card-header:first-child {
        border-radius: 0.35rem 0.35rem 0 0;
      }

      .card-header {
        padding: 1rem 1.35rem;
        margin-bottom: 0;
        background-color: rgba(33, 40, 50, 0.03);
        border-bottom: 1px solid rgba(33, 40, 50, 0.125);
      }

      .form-control,
      .dataTable-input {
        display: block;
        width: 100%;
        padding: 0.875rem 1.125rem;
        font-size: 0.875rem;
        font-weight: 400;
        line-height: 1;
        color: #69707a;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #c5ccd6;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border-radius: 0.35rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
      }

      .nav-borders .nav-link.active {
        color: #0061f2;
        border-bottom-color: #0061f2;
      }

      .nav-borders .nav-link {
        color: #69707a;
        border-bottom-width: 0.125rem;
        border-bottom-style: solid;
        border-bottom-color: transparent;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        padding-left: 0;
        padding-right: 0;
        margin-left: 1rem;
        margin-right: 1rem;
      }
    </style>
  </head>

  <body>
    <div class="container-xl px-4" style="margin-top: 100px; margin-bottom: 100px;">

      <hr class="mt-0 mb-4">
      <div class="row">



        <div class="col-xl-8">
          <!-- Account details card-->
          <div class="card mb-4">
            <div class="card-header">Billing address</div>
            <div class="card-body mb-3">

              {{!-- <div class="dropdown mt-3 mb-4 border p-3">
                <button class=" dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false">
                  Choose an address
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  {{#each addressData}}
                  <p class="dropdown-item">{{this.adressLine1}}</p>
                  <input type="hidden" name="addressId" value="{{this._id}}">
                  {{/each}}

                </div>
              </div> --}}


              <select id="selectedAddress" class="form-select form-select-lg mb-3 p-3"
                aria-label=".form-select-lg example">
                {{!-- <option selected>Select an address</option> --}}
                {{#each addressData}}
                <option value="{{this._id}}">{{this.adressLine1}}</option>
                {{/each}}
              </select>


              {{!-- <div style="text-decoration: none; ">
                <a style="text-decoration: none; font-size: medium; " class="mb-4" href="#">Add new address +</a>
              </div> --}}

              {{!-- modal --}}



              <a href="/addCheckoutaddress">Add new Address +</a>
              <!-- Button trigger modal -->
              {{!-- <div class="card-body border pb-3 pt-2">
                <button type="button" class="mt-2 text-primary" data-toggle="modal" data-target="#exampleModal">
                  Add new Address +
                </button>
              </div> --}}

              <!-- Modal -->
              <div class="modal fade" id="exampleModal" tabindex="-10" role="dialog" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">Address Form</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>




                    {{!-- modal form --}}


                    <div class="modal-body">
                      <div class="container">
                        <div class="row justify-content-center">
                          <div class=" ">
                            <div class="card login-form ">
                              <div class="card-header bg-white border-0">
                                <h3 class="text-center mb-0"></h3>
                              </div>
                              <div class="card-body ">
                                <form action="/add-checkoutaddress" method="post">
                                  <div class="form-group">
                                    <label for="name">Name:</label>
                                    <input type="text" class="form-control" id="name" name="name"
                                      placeholder="Enter name" required>
                                  </div>
                                  <div class="form-group">
                                    <label for="mobile">Mobile:</label>
                                    <input type="tel" class="form-control" id="mobile" name="mobile"
                                      placeholder="Enter mobile" required>
                                  </div>
                                  <div class="form-group">
                                    <label for="address">Address line1:</label>
                                    <input type="text" class="form-control" id="address1" name="address1"
                                      placeholder="Enter address" required>
                                  </div>
                                  <div class="form-group">
                                    <label for="address">Address line2:</label>
                                    <input type="text" class="form-control" id="address2" name="address2"
                                      placeholder="Enter address">
                                  </div>
                                  <div class="form-group">
                                    <label for="city">City:</label>
                                    <input type="text" class="form-control" id="city" name="city"
                                      placeholder="Enter city" required>
                                  </div>
                                  <div class="form-group">
                                    <label for="state">State:</label>
                                    <input type="text" class="form-control" id="state" name="state"
                                      placeholder="Enter state" required>
                                  </div>
                                  <div class="form-group">
                                    <label for="pin">Pin:</label>
                                    <input type="text" class="form-control" id="pin" name="pin"
                                      placeholder="Enter pin code" required>
                                  </div>

                                  <button type="submit" class="btn btn-primary btn-block mt-4">Submit</button>
                                </form>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      {{!-- <button type="button" class="btn btn-primary">Save changes</button> --}}
                    </div>
                  </div>
                </div>
              </div>
            </div>


          </div>

          <div class="card mb-4">
            <div class="card-header">Payment Details</div>
            <div class="card-body">
              <h6 class="mb-3">Choose a payment method</h6>
              <div class="form-check mt-4">
                <input class="form-check-input" type="radio" name="payment_option" value="cash-on-delivery"
                  id="cash-on-delivery">
                <label class="form-check-label" for="flexRadioDefault1">
                  Cash On Delivery
                </label>
              </div>
              <div class="form-check mt-3 mb-3">
                <input class="form-check-input" type="radio" name="payment_option" value="razorpay" id="razorpay">
                <label class="form-check-label" for="flexRadioDefault2">
                  Razor Pay
                </label>
              </div>
              <div class="form-check mt-3 mb-3">
                <input class="form-check-input" type="radio" name="payment_option" value="wallet" id="wallet">
                <label class="form-check-label" for="flexRadioDefault2">
                  Wallet
                </label>
              </div>
              <div class="bg-dark text-white p-15 rounded ml-3" style="width: fit-content;">
                <p class="my-2 mx-2" style="font-size: smaller;">Available Balance : <strong>â‚¹<span
                      id="update_wallet">{{userData.wallet}}</span> </strong></p>
                <input type="hidden" value="{{userData.wallet}}" name="wallet">
              </div>
            </div>
          </div>
          <span id="order_button">
            <button onclick="placeOrder()" class="btn btn-primary btn-lg"> Place Order</button>
          </span>
        </div>


        <div class="col-xl-4">
          <!-- Profile picture card-->
          <div class="card mb-4 mb-xl-0">
            {{!-- <div class="card-header">Your cart</div> --}}

            <h4 class="d-flex justify-content-between align-items-center mb-3 card-header">
              <span class=" text-muted">Your cart</span>
              <span class="badge badge-secondary badge-pill"></span>
            </h4>
            <ul class="list-group mb-3">
              {{#each cart}}
              <li class="list-group-item d-flex justify-content-between lh-condensed">
                <div>
                  <h6 class="my-0">{{this.product.name}} </h6>
                  {{!-- <small class="text-muted">{{this.quantity}} * ${{this.product.price }} </small> --}}
                </div>
                <span class="text-muted"> {{this.quantity }} x â‚¹ {{this.product.price }} </span>
              </li>
              {{/each}}
              {{!-- <li class="list-group-item d-flex justify-content-between lh-condensed">
                <div>
                  <h6 class="my-0">Second product</h6>
                  <small class="text-muted">Brief description</small>
                </div>
                <span class="text-muted">$8</span>
              </li> --}}
              {{!-- <li class="list-group-item d-flex justify-content-between lh-condensed">
                <div>
                  <h6 class="my-0">Third item</h6>
                  <small class="text-muted">Brief description</small>
                </div>
                <span class="text-muted">$5</span>
              </li> --}}

              <li class="list-group-item d-flex justify-content-between bg-light">
                <div class="text-success">
                  <h6 class="my-0">Coupon code</h6>
                  <span id="coupuon_code">
                    <small></small>
                  </span>
                </div>
                <span id="discount_amt">
                  <span class="text-success"></span>
                </span>
              </li>
              <li class="list-group-item d-flex justify-content-between">
                <span>Total (INR)</span>
                {{!-- <span id="new_sub_total">
                  <span id="total">â‚¹ {{subTotal}}</span>
                </span> --}}
                <span id="new_total">â‚¹ {{subTotal}}</span>
                <input hidden="" name="subTotal" value="{{subTotal}}" id="subTotal">
              </li>

            </ul>

            <div class="card p-2">
              <div class="input-group">
                <input type="text" id="coupon" class="form-control" placeholder="Promo code" name="coupon" required>
                <div class="input-group-append">
                  <button onclick="validateCoupon()" type="button" class="btn btn-secondary ml-2 mt-1">Redeem</button>
                </div>
              </div>
              <div class="text-center m-2" style="color: red;" id="couponMsg"> </div>
              <p class="text-center m-2" style="color: green;" id="sCouponMsg"> </p>

              <div class="border" style="padding: 10px; border-radius: 5px;">
                <details>
                  <summary>Available coupons</summary>
                  {{#if availableCoupons}}
                  {{#each availableCoupons}}
                  <div class="d-flex justify-content-between">
                    <h6 class="my-2">{{this.code}}</h6>
                    <p>Get {{this.discount}}% discount</p>
                  </div>
                  {{else}}
                  <h6 class="mb-3">No coupon available</h6>
                  {{/each}}
                  {{/if}}
                </details>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    </div>
  </body>

  </html>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/AlertifyJS/1.13.1/alertify.min.js"></script>

  <script>
    

   

    const paymentOption = document.querySelectorAll('input[name="payment_option"]');

    let paymentMethod = null;

    paymentOption.forEach((checkbox) => {
      checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
          paymentMethod = checkbox.value
          console.log("User selected " + checkbox.value);
          console.log(paymentMethod, 'payment method..........')
        } else {
          console.log("User unchecked " + checkbox.value);
        }
      });
    });


    const placeOrder = () => {
      if (paymentMethod === 'cash-on-delivery') {
        Cod()
      } else if (paymentMethod === "razorpay") {
        online()
      } else if (paymentMethod === 'wallet') {
        useWallet()
      } else {
        console.log('Invalid payment method.')
      }
    }

   

    const Cod = async () => {
      const selectAddress = document.querySelector('#selectedAddress').value
      subTotal = Number(document.getElementsByName('subTotal')[0].value)
        console.log(subTotal)
      const datas = await fetch('/place_order', {
        method: 'POST',
        headers: {
          'Content-Type': "application/json",
        },
        body: JSON.stringify({
          selectedAddress: selectAddress,
          selectedPayment: paymentMethod,
          amount: subTotal
          
        })
      })
      const placeOrderData = await datas.json()
      console.log(placeOrderData + 'cheking here......now')
      if (placeOrderData) {
        console.log(' hiiii am from place order data')
        //const wallet = document.getElementById('update_wallet').innerText = updateWallet

        window.location.href = '/order_success'
      }
    }

    const online = () => {
      subTotal = Number(document.getElementsByName('subTotal')[0].value)
      var options = {
        "key": "rzp_test_9ImU45oZDtopLe", // Enter the Key ID generated from the Dashboard
        "amount": subTotal * 100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",

       

        "order_id": undefined, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        "handler": function (response) {
          Cod()
        },
      };
      var rzp1 = new Razorpay(options);
      rzp1.open();
    }
   <script src="https://checkout.razorpay.com/v1/checkout.js"></script>




    

    
        



          
  </script>


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
  </body>
</html>